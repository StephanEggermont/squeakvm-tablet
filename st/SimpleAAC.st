ProtoObject subclass: #AACImageConfigWindow	instanceVariableNames: 'modelSays modelCategory saysMorph catMorph'	classVariableNames: ''	poolDictionaries: ''	category: 'SimpleAAC'!!AACImageConfigWindow methodsFor: 'as yet unclassified' stamp: 'DmitryGolubovsky 1/17/2011 16:43'!initWithModel: aModel  model := aModel.  model ifNotNil: [self modelSays: (model says) . 	                          (model category) ifNil: [self modelCategory: '']	                                                     ifNotNil: [self modelCategory: (model category)]	].  super initialize.! !!AACImageConfigWindow methodsFor: 'as yet unclassified' stamp: 'DmitryGolubovsky 1/17/2011 21:51'!newTextMorph: agetSymbol set: asetSymbol help: aString	"Answer a new text entry morph."      | tm |	tm := (self		      newTextEntryFor: self		      getText: agetSymbol		      setText: asetSymbol		      getEnabled: nil		      help: aString).	tm	autoAccept: true; autoAccept: true; getText.	^ tm.! !!AACImageConfigWindow methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/17/2011 16:44'!modelCategory  ^(modelCategory asString).! !!AACImageConfigWindow methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/16/2011 22:27'!modelCategory: aString  modelCategory := aString asSymbol! !!AACImageConfigWindow methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/16/2011 22:21'!modelSays  ^modelSays! !!AACImageConfigWindow methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/16/2011 23:27'!modelSays: aString  modelSays := aString! !!AACImageConfigWindow methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/17/2011 21:58'!newContentMorph	"Answer a new content morph."	saysMorph:= self newTextMorph: #modelSays set: #modelSays: 	    help: 'What this picture says on the story strip. A synth phrase or a sound file path'.	catMorph:= self newTextMorph: #modelCategory set: #modelCategory: help: 'Category for this picture'.	^self newGroupboxFor: (self newColumn: {self newGroupbox: 'Says:' for: saysMorph. 	                                                                self newGroupbox: 'Category:' for: catMorph})	! !!AACImageConfigWindow methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/17/2011 21:53'!newTextMorph: agetSymbol set: asetSymbol	"Answer a new text entry morph."  ^(self newTextMorph: agetSymbol set: asetSymbol help: nil).! !!AACImageConfigWindow methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/16/2011 23:56'!ok  "ok button was pressed: if model has been defined, commit changes"  model ifNotNil: [	  model says: modelSays;	            category: modelCategory.	].  self delete.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!AACImageConfigWindow class	instanceVariableNames: ''!!AACImageConfigWindow class methodsFor: 'instance creation' stamp: 'DmitryGolubovsky 1/17/2011 00:21'!newFor: aModel  ^ self basicNew  initWithModel: aModel.! !SystemWindow subclass: #AACStrip	instanceVariableNames: 'images imgspace ready'	classVariableNames: ''	poolDictionaries: ''	category: 'SimpleAAC'!!AACStrip methodsFor: 'dropping/grabbing' stamp: 'DmitryGolubovsky 1/22/2011 23:00'!acceptDroppingMorph: aMorph event: ev  "if the dropping morph is accepted it gets owned by the nested alignment morph (imgspace)"  imgspace addMorphBack: aMorph.  aMorph onStrip: true.  self updateStory.  SimpleAAC playing: nil.! !!AACStrip methodsFor: 'change reporting' stamp: 'DMG 2/2/2011 06:33'!changed	| istl isbr |	ready		ifTrue: [istl := labelArea fullBounds bottomLeft.			isbr := self bounds bottomRight.			imgspace				bounds: (istl corner: isbr).			self updateStory].	super changed! !!AACStrip methodsFor: 'change reporting' stamp: 'DmitryGolubovsky 1/22/2011 21:48'!updateStory  "if a picture is added or removed from the strip, update the title"  | story |  story := (imgspace submorphs collect: [ :m | m says ]) inject: '' into: [ :s :n | s, ' ', n.] .  (story allSatisfy: [:c | c = Character space ]) ifTrue: [ story := 'No story told yet'].  self setLabel: story.  SimpleAAC playing: nil.! !!AACStrip methodsFor: 'initialization' stamp: 'DmitryGolubovsky 1/21/2011 21:54'!initialize  ready := false.  super initialize.  images := {}.  self setLabel: 'No story told yet'.  imgspace := AlignmentMorph new.  self addMorph: imgspace after: labelArea.  ready := true.  self changed.! !!AACStrip methodsFor: 'as yet unclassified' stamp: 'DmitryGolubovsky 1/21/2011 22:03'!repelsMorph: aMorph event: ev  "changing the behaviour of the dropped morph when it is rejected"  ^ (self wantsDroppedMorph: aMorph event: ev) not! !!AACStrip methodsFor: 'as yet unclassified' stamp: 'DmitryGolubovsky 1/21/2011 22:03'!wantsDroppedMorph: aMorph event: anEvent  "if the dropped morph responds to the #says message, accept it"  ^ aMorph respondsTo: #says.! !ImageMorph subclass: #FileImageMorph	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SimpleAAC'!"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!FileImageMorph class	instanceVariableNames: ''!!FileImageMorph class methodsFor: 'instance creation' stamp: 'DMG 2/1/2011 21:28'!fromImageFileNamed: aFile 	"create from an external image file"	(self respondsTo: #withForm:)		ifTrue: [^ self				withForm: (ImageReadWriter formFromFileNamed: aFile)  "for Pharo"]		ifFalse: [^ self new				image: (Form fromFileNamed: aFile)  "for Squeak"]! !FileImageMorph subclass: #AACImageMorph	instanceVariableNames: 'category says onStrip'	classVariableNames: ''	poolDictionaries: ''	category: 'SimpleAAC'!!AACImageMorph methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/17/2011 00:08'!category  ^category.! !!AACImageMorph methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/16/2011 23:36'!category: aSymbol  category := aSymbol.  self changed.! !!AACImageMorph methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/21/2011 23:14'!onStrip  ^ onStrip.! !!AACImageMorph methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/21/2011 23:14'!onStrip: aBool  onStrip := aBool.! !!AACImageMorph methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/17/2011 00:08'!says  ^says.! !!AACImageMorph methodsFor: 'accessing' stamp: 'DmitryGolubovsky 1/16/2011 23:59'!says: aString  "specify that a spoken text is associated with this image"  (aString = '') ifTrue: [says := nil] ifFalse: [says := aString].  self changed.! !!AACImageMorph methodsFor: 'drawing' stamp: 'DmitryGolubovsky 1/13/2011 06:39'!drawOn: aCanvas  "draw itself first, if says = true draw a speech icon"  super drawOn: aCanvas.  says ifNotNil:    [aCanvas translucentImage: (SimpleAAC iconSpeech) at: self innerBounds origin].! !!AACImageMorph methodsFor: 'event handling' stamp: 'DMG 3/21/2011 23:10'!handlesMouseDown: anEvent  "in the configuration mode, mouse events are handled to bring up image configuration dialog"  ^ (SimpleAAC configmode) | (onStrip = true).! !!AACImageMorph methodsFor: 'event handling' stamp: 'DMG 3/21/2011 23:10'!handlesMouseStillDown: evt  ^(onStrip = true).! !!AACImageMorph methodsFor: 'event handling' stamp: 'DmitryGolubovsky 1/21/2011 23:28'!mouseDown: anEvent  "This morph receives MouseEvents when AAC is in config mode (in work mode AAC morphs are just    draggable. Clicking the yellow (right) button causes the config dialog to pop up."  anEvent yellowButtonPressed & ((onStrip = true) not) ifTrue: [ | w |	  w := AACImageConfigWindow newFor: self.	  w  setLabel: 'Configure' ;	      openInWorld ;	      position: (self center).	].  "Clicking the red (left) button causes the phrase to be pronounced if sound wrapper is available"  anEvent redButtonPressed ifTrue: [ SimpleAAC say: (self says) playing: self].! !!AACImageMorph methodsFor: 'event handling' stamp: 'DmitryGolubovsky 1/22/2011 23:04'!mouseStillDown: evt  onStrip := false.  self currentHand attachMorph: self.  ! !!AACImageMorph methodsFor: 'event handling' stamp: 'DMG 3/21/2011 22:59'!mouseStillDownThreshold	"Return the number of milliseconds after which mouseStillDown: should be sent"	^600.! !!AACImageMorph methodsFor: 'initialization' stamp: 'DmitryGolubovsky 1/21/2011 23:13'!initialize  super initialize.  says := nil.  category := #''.  onStrip = false.! !!AACImageMorph methodsFor: 'dropping/grabbing' stamp: 'DmitryGolubovsky 1/22/2011 00:21'!justGrabbedFrom: formerOwner  "if grabbed from the strip, flag that we are no longer on the strip"  super justGrabbedFrom: formerOwner.  (onStrip = true) ifTrue: [ formerOwner owner changed. ].  onStrip := false.! !Object subclass: #SimpleAAC	instanceVariableNames: ''	classVariableNames: 'configmode soundWrapper'	poolDictionaries: ''	category: 'SimpleAAC'!"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SimpleAAC class	instanceVariableNames: ''!!SimpleAAC class methodsFor: 'configuration' stamp: 'DmitryGolubovsky 1/13/2011 21:11'!configmode  "returns true if config mode is enabled"  configmode isNil ifTrue: [configmode := false. ^false]                            ifFalse: [^configmode]! !!SimpleAAC class methodsFor: 'configuration' stamp: 'DmitryGolubovsky 1/13/2011 21:12'!configmode: aBool  "set AAC configuration mode"  configmode := aBool.! !!SimpleAAC class methodsFor: 'configuration' stamp: 'DmitryGolubovsky 1/20/2011 21:58'!soundWrapper: aWrapper  "set the sound wrapper"  soundWrapper := aWrapper.! !!SimpleAAC class methodsFor: 'icons' stamp: 'DmitryGolubovsky 1/12/2011 23:15'!iconSpeech  "icon image to be placed on an AACImageMorph when spoken message is defined for this image"^(Form	extent: 32@32	depth: 32	fromArray: #( 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 134217728 1107296256 1073741824 234881024 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3305111552 4278190080 4076863488 4227858432 4278190080 4009754624 2348810240 285212672 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4278190080 0 0 0 150994944 1291845632 2902458368 4278190080 2214592512 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4278190080 0 0 0 0 0 0 452984832 3774873600 3053453312 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4278190080 0 0 0 0 0 0 0 0 3791650816 1879048192 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4278190080 0 0 0 0 0 0 0 0 536870912 4278190080 0 0 0 0 0 0 0 0 1610612736 0 0 0 0 0 0 0 0 0 0 0 0 4278190080 0 0 0 0 0 0 0 0 0 3556769792 1006632960 0 0 0 0 0 0 2164260864 1224736768 1811939328 0 0 0 0 0 0 0 0 0 0 0 4278190080 0 0 0 0 0 0 0 0 0 2952790016 1224736768 0 0 0 0 3019898880 2399141888 0 2382364672 2818572288 0 0 0 0 0 0 0 0 0 0 0 4278190080 0 0 0 0 0 0 0 0 0 3556769792 671088640 0 654311424 2449473536 0 2936012800 1493172224 754974720 2919235584 2097152000 201326592 0 0 0 0 0 0 0 0 0 0 4278190080 0 0 0 0 0 0 0 0 0 4076863488 318767104 0 2365587456 1459617792 1207959552 1543503872 1073741824 2600468480 2046820352 1342177280 1610612736 0 0 0 0 0 0 0 0 0 0 4076863488 0 0 0 0 0 0 0 0 0 2382364672 2801795072 0 352321536 2214592512 2684354560 0 2550136832 2634022912 838860800 1358954496 2566914048 0 0 0 0 0 0 0 0 0 0 3825205248 0 0 0 0 0 0 0 0 0 0 3674210304 1056964608 0 2701131776 2566914048 0 2650800128 2550136832 100663296 1996488704 2785017856 0 0 0 0 0 0 0 0 0 0 3573547008 0 0 0 0 0 0 0 0 0 637534208 1895825408 2365587456 0 2969567232 2701131776 0 3019898880 2852126720 0 2516582400 3036676096 0 0 0 0 0 0 0 0 0 0 3321888768 0 0 0 0 0 0 0 0 369098752 3976200192 2667577344 536870912 0 3556769792 3456106496 0 3523215360 3388997632 100663296 2818572288 3388997632 0 0 0 0 0 0 0 0 0 0 3087007744 0 0 0 0 0 0 0 2449473536 3137339392 2902458368 0 0 0 4127195136 3875536896 0 4278190080 3305111552 587202560 3321888768 3170893824 0 0 0 0 0 0 0 0 0 0 2885681152 0 0 0 0 0 0 0 3120562176 1979711488 0 0 0 1342177280 3791650816 3187671040 721420288 4278190080 2634022912 1409286144 3674210304 2650800128 0 0 0 0 0 0 0 0 0 0 2717908992 0 0 0 0 0 0 0 0 2432696320 1291845632 0 0 3372220416 3254779904 1811939328 2063597568 4278190080 1560281088 2483027968 3841982464 1795162112 0 0 0 0 0 0 0 0 0 0 2634022912 0 0 0 0 0 0 0 0 3120562176 0 0 905969664 3724541952 4076863488 0 3690987520 4278190080 0 3892314112 3875536896 704643072 0 0 0 0 0 0 0 0 0 0 2634022912 0 0 0 0 1006632960 1191182336 134217728 452984832 1677721600 0 0 3422552064 4076863488 2751463424 989855744 4278190080 3170893824 721420288 3539992576 4177526784 0 0 0 0 0 0 0 0 0 0 0 2600468480 0 0 0 0 2566914048 671088640 2147483648 2919235584 251658240 0 0 754974720 3707764736 721420288 4143972352 4278190080 872415232 3774873600 2533359616 2516582400 0 0 0 0 0 0 0 0 0 0 0 2566914048 0 0 0 0 2415919104 0 0 0 0 0 0 0 0 2617245696 4278190080 3724541952 1644167168 2986344448 3976200192 503316480 0 0 0 0 0 0 0 0 0 0 0 2113929216 2248146944 2097152000 1962934272 1811939328 2214592512 0 0 0 0 0 0 0 0 0 2264924160 721420288 4278190080 2852126720 3154116608 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1073741824 4278190080 4278190080 369098752 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1342177280 1006632960 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)	offset: 0@0)! !!SimpleAAC class methodsFor: 'utility' stamp: 'DmitryGolubovsky 1/12/2011 22:07'!imgStream: aFile  "invoke this method to obtain a stream from am external image file"  | image stream |  image := ColorForm fromFileNamed: aFile.  stream := WriteStream with: String new.  image storeOn: stream.  ^stream contents.! !!SimpleAAC class methodsFor: 'speech synthesis' stamp: 'DmitryGolubovsky 1/22/2011 21:48'!playing: aHash  "specify a hash for the sound wrapper to identify the last played phrase. can be used to set the hash   to nil so the sound wrapper can repeat whatever it played"   | s |	  s := SimpleAAC soundWrapper.	  (s notNil) ifTrue:  [ s playing: aHash.].! !!SimpleAAC class methodsFor: 'speech synthesis' stamp: 'DmitryGolubovsky 1/21/2011 05:32'!say: aPhrase  "pronounce the phrase given if sound wrapper is configured, with default voice. the phrase may be   repeated (no hash will be stored in the sound wrapper"  SimpleAAC say: aPhrase playing: nil.! !!SimpleAAC class methodsFor: 'speech synthesis' stamp: 'DmitryGolubovsky 1/21/2011 05:29'!say: aPhrase playing: aHash  "the most common way to invoke a speech syntesizer. if defined and configured, this method pronounces   the phrase given with the default voice. the hash will be stored in the sound wrapper, and thus the last   played whatever would not be repeated. if playing is nil then the phrase will be played anyway"  | s |	  s := SimpleAAC soundWrapper.	  (s notNil and: [aPhrase notNil]) ifTrue:  [ | h | 		aHash isNil | ((aHash = s playing) not) ifTrue: [			        s playing: aHash.   		              s say: aPhrase ]	].! !!SimpleAAC class methodsFor: 'as yet unclassified' stamp: 'DMG 3/21/2011 22:28'!soundWrapper	"answer the currently set sound wrapper unless running in Android"	(AndroidTTS inAndroid) 		ifTrue: [^AndroidSoundWrapper new]		ifFalse: [^soundWrapper].	! !Object subclass: #SoundWrapper	instanceVariableNames: 'pgmPath libPath defaultVoice playing'	classVariableNames: ''	poolDictionaries: ''	category: 'SimpleAAC'!!SoundWrapper methodsFor: 'configuration' stamp: 'DmitryGolubovsky 1/20/2011 22:06'!defaultVoice  "answer the default voice (may be nil)"  ^ defaultVoice.! !!SoundWrapper methodsFor: 'configuration' stamp: 'DmitryGolubovsky 1/21/2011 05:09'!defaultVoice: aSymbol  "set default voice: should be on the list of voices available"  | vs hasvoice |  vs := self listVoices.  hasvoice := vs anySatisfy: [ :s | s = aSymbol ].  hasvoice ifTrue: [defaultVoice := aSymbol]                ifFalse: [StandardWindow new alert: 'Voice ', aSymbol asString, ' is not available'].  ^self.! !!SoundWrapper methodsFor: 'configuration' stamp: 'DMG 2/3/2011 06:06'!libPath: aPath 	"specify path to the portaudio shared library"	libPath := aPath! !!SoundWrapper methodsFor: 'configuration' stamp: 'DmitryGolubovsky 1/18/2011 22:37'!pgmPath: aFile  "set the TTS program path for future reference"  pgmPath := aFile.! !!SoundWrapper methodsFor: 'access' stamp: 'DmitryGolubovsky 1/18/2011 22:44'!listVoices  "answers a list of symbols each identifying a voice available"  ^ self subclassResponsibility.! !!SoundWrapper methodsFor: 'access' stamp: 'DmitryGolubovsky 1/21/2011 00:06'!playing  ^playing.! !!SoundWrapper methodsFor: 'access' stamp: 'DmitryGolubovsky 1/21/2011 00:11'!playing: aHash  "set playing to the hash of the image last played. this may help avoid repetitions of the same sound if    the same image is repeatedly clicked. use of this method is advisory."  playing := aHash.! !!SoundWrapper methodsFor: 'speech synthesis' stamp: 'DmitryGolubovsky 1/20/2011 22:05'!say: aPhrase  "say the given phrase with default voice whatever it may be"  ^self say: aPhrase withVoice: defaultVoice.! !!SoundWrapper methodsFor: 'speech synthesis' stamp: 'DmitryGolubovsky 1/20/2011 22:03'!say: aPhrase withVoice: aSymbol  "say the given phrase with specified voice. if the voice is not available, try the default voice.   if the default voice is not available either, use the external program default voice"  ^ self subclassResponsibility.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SoundWrapper class	instanceVariableNames: ''!!SoundWrapper class methodsFor: 'instance creation' stamp: 'DmitryGolubovsky 1/18/2011 22:42'!withPgmOn: aFile  ^ self new pgmPath: aFile.! !SoundWrapper subclass: #AndroidSoundWrapper	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SimpleAAC'!!AndroidSoundWrapper methodsFor: 'access' stamp: 'DMG 3/21/2011 22:22'!listVoices	"answer a list of voices available"	^(AndroidVoices class) allMethodsInCategory: #voices.! !!AndroidSoundWrapper methodsFor: 'speech synthesis' stamp: 'DMG 3/21/2011 22:48'!say: aPhrase withVoice: aSymbol  "say the given phrase with specified voice. if the voice is not available, try the default voice."	"AndroidVoices perform: aSymbol."	AndroidTTS speak: aPhrase.! !!AndroidSoundWrapper methodsFor: 'configuration' stamp: 'DMG 3/21/2011 22:25'!defaultVoice	"answers the default voice"	^#default.! !SoundWrapper subclass: #EspeakSoundWrapper	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SimpleAAC'!!EspeakSoundWrapper methodsFor: 'access' stamp: 'DMG 2/3/2011 06:26'!listVoices	"Invoke speak --voices=en and read back whatever it outputs, pick	the 4th column, 	drop the first token. 	Expected message format is <whatever> : space-separated-list"	| lp cmd out outsplit |	libPath		ifNil: [lp := '']		ifNotNil: [lp := libPath].	cmd := 'LD_LIBRARY_PATH=' , lp , ' ' , pgmPath , ' --voices=en | awk ''{print $4}'' '.	out := (PipeableOSProcess command: cmd) output.	"split into lines, then drop the first one"	outsplit := ((out subStrings: {Character lf})				copyWithout: 'VoiceName')				collect: [:s | s asSymbol].	^ outsplit! !!EspeakSoundWrapper methodsFor: 'speech synthesis' stamp: 'DMG 2/3/2011 06:35'!say: aPhrase withVoice: aVoice 	"invoke the external speak program to say the phrase specified with	the voice specified.	if the voice is nil then run speak without the voice option. Answer with	whatever the external	speak program outputs, and returns only after the program completes"	| lp voiceopt cmd out |	libPath		ifNil: [lp := '']		ifNotNil: [lp := libPath].	aVoice		ifNil: [voiceopt := '']		ifNotNil: [voiceopt := '-v ' , aVoice asString].	cmd := 'LD_LIBRARY_PATH=' , lp , ' ' , pgmPath , ' ' , voiceopt , ' "' , aPhrase , '"'.	out := (PipeableOSProcess command: cmd) output.	^ out! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!EspeakSoundWrapper class	instanceVariableNames: ''!!EspeakSoundWrapper class methodsFor: 'instance creation' stamp: 'DMG 2/3/2011 05:28'!withPgmOn: aFile withLibraryOn: aLib	"create my instance with program and shared library locations specified"	^self new pgmPath: aFile ;	libPath: aLib.! !SoundWrapper subclass: #FliteSoundWrapper	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SimpleAAC'!!FliteSoundWrapper methodsFor: 'access' stamp: 'DMG 2/1/2011 21:53'!listVoices	"Invoke flite -lv and read back whatever it outputs. 	Expected message format is <whatever> : space-separated-list"	| out outsplit |	out := (PipeableOSProcess command: pgmPath , ' -lv') output.	"split at the position of colon. add a fake one so if the output does	not have a colon, an empty string	is returned rather than an error"	(out respondsTo: #splitOn:)		ifTrue: [outsplit := out , ':' splitOn: ':'			"for Pharo"]		ifFalse: [outsplit := out , ':' splitBy: ':'"for Squeak"].		^ (((outsplit at: 2)		subStrings: ' ')		select: [:s | (s = Character lf asString) not])		collect: [:s | s asSymbol]! !!FliteSoundWrapper methodsFor: 'speech synthesis' stamp: 'DmitryGolubovsky 1/21/2011 00:09'!say: aPhrase withVoice: aVoice  "invoke the external flite program to say the phrase specified with the voice specified.   if the voice is nil then run flite without the voice option. Answer with whatever the external   flite program outputs, and returns only after the program completes"  | voiceopt cmd out |  aVoice ifNotNil: [voiceopt := '-voice ', (aVoice asString)]             ifNil: [voiceopt := ''].  cmd := pgmPath, ' ', voiceopt, ' -t "', aPhrase, '"'.  out := (PipeableOSProcess command: cmd) output .  ^out.! !